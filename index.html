<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>ã‚‚ã¡ã‚‚ã®ãƒã‚§ãƒƒã‚«ãƒ¼</title>
<meta name="description" content="å°å­¦ç”Ÿã§ã‚‚ä½¿ã„ã‚„ã™ã„æŒã¡ç‰©ãƒã‚§ãƒƒã‚¯ã€‚ç™»éŒ²ãƒ»ç·¨é›†ãƒ»å‰Šé™¤ã€ãƒã‚§ãƒƒã‚¯ã€å…¨è§£é™¤ã€âœ…å‰Šé™¤ã€é€²æ—ãƒãƒ¼ã€ã‚¹ã‚¿ãƒ³ãƒ—ã€ã”ã»ã†ã³æ¼”å‡ºã€‚ç«¯æœ«ã«è‡ªå‹•ä¿å­˜ã€‚">
<style>
  :root { color-scheme: light dark; }
  * { box-sizing: border-box; }
  body{
    margin:0; font-family: ui-rounded, system-ui, "Hiragino Kaku Gothic ProN", "Noto Sans JP", sans-serif;
    background: linear-gradient(180deg,#f7fbff 0%,#fff 60%,#fff7f3 100%);
    color:#222;
  }
  header{
    position:sticky; top:0; z-index:5;
    backdrop-filter: blur(6px);
    background: color-mix(in oklab, white 90%, transparent);
    border-bottom:1px solid #eee;
    padding: 12px 14px; text-align:center;
  }
  .title{ font-weight:900; font-size:1.25rem; }
  .sub{ font-size:.95rem; opacity:.8; }

  .wrap{ max-width:760px; margin: 8px auto 96px; padding: 0 12px; }

  /* å…¥åŠ› */
  .addRow{ margin-top:12px; display:flex; gap:8px; }
  .addRow input{
    flex:1; padding:14px 16px; font-size:1rem; border-radius:14px; border:2px solid #c8e6ff; background:#fff;
  }
  .btnPrimary{
    padding:14px 18px; border:none; border-radius:14px; font-weight:800; font-size:1rem; color:white;
    background: linear-gradient(135deg,#6ea8ff,#7bd5ff);
    box-shadow: 0 3px 0 rgba(0,0,0,.08);
  }
  .btnPrimary:active{ transform: translateY(1px); }

  /* ã‚ˆãä½¿ã†ï¼ˆãƒãƒƒãƒ—ï¼‰ */
  .chips{ display:flex; gap:8px; flex-wrap:wrap; margin:10px 2px 0; }
  .chip{
    padding:10px 12px; background:#fff; border:2px dashed #ffd66e; border-radius:999px; font-weight:700; user-select:none;
  }

  /* æ“ä½œãƒãƒ¼ï¼ˆâ€»ã™ã¹ã¦ãƒã‚§ãƒƒã‚¯ç„¡ã—ï¼‰ */
  .bar{ display:flex; gap:8px; margin:14px 0 8px; }
  .bar .btn{
    flex:1; padding:12px; border:none; border-radius:12px; font-weight:800; background:#ffeec2;
  }
  .bar .danger{ background:#ffe0e0; }

  /* é€²æ— */
  .progressBox{
    background:#fff; border:2px solid #d9f1ff; border-radius:16px; padding:10px 12px; margin:10px 0 4px;
  }
  .progressTop{ display:flex; justify-content:space-between; align-items:center; font-weight:800; font-size:.95rem; }
  .barLine{ height:12px; border-radius:999px; background:#f1f5f9; overflow:hidden; margin-top:8px; }
  .barFill{ height:100%; width:0%; background:linear-gradient(90deg,#7bd5ff,#91f0b8); }

  /* ãƒªã‚¹ãƒˆ */
  ul{ list-style:none; padding:0; margin:10px 0 0; }
  li{
    background:#ffffff; border:2px solid #f0f0f0; border-radius:16px;
    display:flex; align-items:center; gap:10px; padding:12px; margin:10px 0;
    box-shadow: 0 2px 0 rgba(0,0,0,.04);
  }
  li .icon{ font-size:1.4rem; width:1.8rem; text-align:center; }
  li label{ display:flex; align-items:center; gap:12px; flex:1; }
  li input[type=checkbox]{ width:26px; height:26px; }
  li .name{ font-size:1.05rem; font-weight:800; }
  li.checked{ border-color:#c8f5d4; background:#f6fff8; }
  li.checked .name{ text-decoration: line-through; opacity:.6; }
  .actions{ display:flex; gap:6px; }
  .iconbtn{ padding:8px 10px; border-radius:10px; border:1px solid #ddd; background:#fff; font-weight:800; }

  /* ãƒ•ãƒƒã‚¿ãƒ¼ */
  footer{
    position:fixed; left:0; right:0; bottom:0; z-index:6;
    background: color-mix(in oklab, white 90%, transparent);
    border-top:1px solid #eee; padding:10px 12px;
  }
  .footRow{
    max-width:760px; margin:0 auto; display:flex; align-items:center; justify-content:space-between; gap:10px;
  }
  .stamp{ display:flex; align-items:center; gap:8px; font-weight:900; }
  .stamp .count{ padding:6px 10px; background:#fff; border:2px solid #ffd66e; border-radius:10px; }
  .ts{ font-size:.85rem; opacity:.75; }

  /* ãƒ¢ãƒ¼ãƒ€ãƒ« */
  .modal{ position:fixed; inset:0; display:none; place-items:center; z-index:20; background: rgba(0,0,0,.3); }
  .card{
    width:min(92vw,420px); background:#fff; border-radius:20px; padding:20px; text-align:center; border:3px solid #c8f5d4;
  }
  .card h3{ margin:6px 0 8px; font-size:1.2rem; }
  .card p{ margin:6px 0 14px; }
  .card .ok{ padding:12px 16px; border:none; border-radius:12px; font-weight:900; background:#91f0b8; }

  /* ã‹ã‚“ãŸã‚“ã‚¢ãƒ‹ãƒ¡ */
  @keyframes pop { 0%{transform:scale(.9)} 60%{transform:scale(1.05)} 100%{transform:scale(1)} }
  .pop { animation: pop .18s ease-out; }
  .cele{ position:fixed; left:0; top:0; width:100%; height:0; pointer-events:none; z-index:30; }

  /* ãƒ€ãƒ¼ã‚¯ */
  @media (prefers-color-scheme: dark){
    body{ background: linear-gradient(180deg,#0f1220 0%,#121a22 60%,#101416 100%); color:#f1f5f9;}
    .addRow input{ background:#0f1218; color:#e8f0ff; border-color:#2a3b52;}
    .chip{ background:#0f1218; border-color:#665500; }
    .bar .btn{ background:#2a2f36; color:#e5e7eb; }
    .bar .danger{ background:#3a2528; }
    .progressBox{ background:#0f1218; border-color:#213041; }
    li{ background:#0f1218; border-color:#2b2b2b; }
    li.checked{ background:#0e1a12; border-color:#15351f; }
    .iconbtn{ background:#11151a; border-color:#333; color:#e5e7eb; }
    footer{ background: rgba(8,10,14,.7); border-color:#222; }
    .card{ background:#0f1218; border-color:#15351f; }
  }
</style>
</head>
<body>
  <header>
    <div class="title">ã‚‚ã¡ã‚‚ã®ãƒã‚§ãƒƒã‚«ãƒ¼</div>
    <div class="sub">ãã‚‡ã†ï¼ˆ<span id="today">--</span>ï¼‰ã®ã‚‚ã¡ã‚‚ã®ã‚’ãƒã‚§ãƒƒã‚¯ã—ã‚ˆã†</div>
  </header>

  <div class="wrap">
    <!-- å…¥åŠ› -->
    <div class="addRow">
      <input id="newItem" type="text" placeholder="ã‚Œã„ï¼‰ğŸ“± ã‘ã„ãŸã„ / ğŸ’§ ã™ã„ã¨ã† / ğŸ§¢ ã¼ã†ã—" />
      <button id="addBtn" class="btnPrimary">ã¤ã„ã‹</button>
    </div>

    <!-- ã‚ˆãä½¿ã† -->
    <div class="chips" id="chips">
      <span class="chip" data-add="ğŸ“± ã‘ã„ãŸã„">ğŸ“± ã‘ã„ãŸã„</span>
      <span class="chip" data-add="ğŸ”‹ ã˜ã‚…ã†ã§ã‚“ã">ğŸ”‹ ã˜ã‚…ã†ã§ã‚“ã</span>
      <span class="chip" data-add="ğŸ’§ ã™ã„ã¨ã†">ğŸ’§ ã™ã„ã¨ã†</span>
      <span class="chip" data-add="ğŸ§¢ ã¼ã†ã—">ğŸ§¢ ã¼ã†ã—</span>
      <span class="chip" data-add="ğŸ’ ã‹ã°ã‚“">ğŸ’ ã‹ã°ã‚“</span>
      <span class="chip" data-add="ğŸ“— ã¹ã‚“ãã‚‡ã†ã‚»ãƒƒãƒˆ">ğŸ“— ã¹ã‚“ãã‚‡ã†ã‚»ãƒƒãƒˆ</span>
    </div>

    <!-- é€²æ— -->
    <div class="progressBox">
      <div class="progressTop">
        <div>ã˜ã‚‡ã†ãŸã„ï¼š<span id="count">0</span>/<span id="total">0</span></div>
        <div id="cheer">ãŒã‚“ã°ã‚Œï¼</div>
      </div>
      <div class="barLine"><div class="barFill" id="barFill"></div></div>
    </div>

    <!-- æ“ä½œï¼ˆâ€»ã™ã¹ã¦ãƒã‚§ãƒƒã‚¯ç„¡ã—ï¼‰ -->
    <div class="bar">
      <button id="uncheckAllBtn" class="btn">ãœã‚“ã¶ ã¯ãšã™</button>
      <button id="clearCheckedBtn" class="btn danger">âœ…ã‚’ ã‘ã™</button>
    </div>

    <!-- ãƒªã‚¹ãƒˆ -->
    <ul id="list"></ul>
  </div>

  <footer>
    <div class="footRow">
      <div class="stamp">ã‚¹ã‚¿ãƒ³ãƒ— <span class="count" id="stampCount">0ã“</span></div>
      <div class="ts">ã»ãã‚“å…ˆï¼šã“ã®ç«¯æœ« / ã•ã„ã—ã‚…ã†æ›´æ–° <span id="ts">â€“</span></div>
    </div>
  </footer>

  <!-- ãŠç¥ã„ãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div class="modal" id="modal">
    <div class="card">
      <div style="font-size:2rem">ğŸ‰</div>
      <h3>ãœã‚“ã¶ ã§ããŸï¼ã™ã”ã„ï¼</h3>
      <p>ãã‚‡ã†ã®ã‚¹ã‚¿ãƒ³ãƒ—ã‚’ 1ã“ ã¦ã«ã„ã‚ŒãŸã‚ˆ</p>
      <button class="ok" id="okBtn">OK</button>
    </div>
  </div>

  <!-- ç´™ãµã¶ã -->
  <div class="cele" id="cele"></div>

<script>
/* ===============================
   ã‚‚ã¡ã‚‚ã®ãƒã‚§ãƒƒã‚«ãƒ¼ï¼ˆKidsç°¡å˜ç‰ˆï¼‰
   - è¿½åŠ /ç·¨é›†/å‰Šé™¤
   - ãƒã‚§ãƒƒã‚¯ / å…¨è§£é™¤ / âœ…å‰Šé™¤
   - é€²æ—ãƒãƒ¼ãƒ»å¿œæ´
   - å…¨éƒ¨å®Œäº†ã§ã‚¹ã‚¿ãƒ³ãƒ— + ç´™ãµã¶ã + ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆ1æ—¥1å›ï¼‰
   - localStorageä¿å­˜
   =============================== */
const LS_KEY = 'kids_packlist_v1';
let state = {
  items: [],                 // {id, name, checked}
  updatedAt: Date.now(),
  stamps: 0,
  lastStampDate: ""          // "YYYY-MM-DD" äºŒé‡ä»˜ä¸é˜²æ­¢
};

const $ = (s)=>document.querySelector(s);
const listEl = $('#list');
const inputEl = $('#newItem');
const tsEl = $('#ts');
const barFill = $('#barFill');
const countEl = $('#count');
const totalEl = $('#total');
const cheerEl = $('#cheer');
const stampCountEl = $('#stampCount');
const modal = $('#modal');
const cele = $('#cele');

// ä»Šæ—¥
const d = new Date();
const todayStr = `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
$('#today').textContent = `${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;

// çµµæ–‡å­—ã‚¢ã‚¤ã‚³ãƒ³æ¨å®š
function pickIcon(name){
  const n = name.toLowerCase();
  const map = [
    { k: ['ã™ã„ã¨ã†','ã¿ãš','water','bottle'], e:'ğŸ’§'},
    { k: ['ã‘ã„ãŸã„','ã‚¹ãƒãƒ›','phone'], e:'ğŸ“±'},
    { k: ['ã˜ã‚…ã†ã§ã‚“','å……é›»','charger','cable'], e:'ğŸ”‹'},
    { k: ['ã¼ã†ã—','hat','cap'], e:'ğŸ§¢'},
    { k: ['ã‹ã•','umbrella'], e:'â˜‚ï¸'},
    { k: ['ãã¤','shoes'], e:'ğŸ‘Ÿ'},
    { k: ['ã•ã„ãµ','è²¡å¸ƒ','wallet'], e:'ğŸ’³'},
    { k: ['ã¹ã‚“ãã‚‡ã†','ãƒãƒ¼ãƒˆ','æ•™ç§‘æ›¸','pencil','pen','note','text'], e:'ğŸ“—'},
    { k: ['ã‹ã°ã‚“','bag','backpack'], e:'ğŸ’'},
    { k: ['ãƒã‚¹ã‚¯','mask'], e:'ğŸ˜·'}
  ];
  for(const m of map){ if(m.k.some(x => n.includes(x))) return m.e; }
  const first = name.trim().charAt(0);
  return /\p{Extended_Pictographic}/u.test(first)? first : 'ğŸ“Œ';
}

function uid(){ return Date.now().toString(36)+Math.random().toString(36).slice(2,6); }
function fmtTime(t){
  const d=new Date(t);
  const mm=String(d.getMonth()+1).padStart(2,'0');
  const dd=String(d.getDate()).padStart(2,'0');
  const h=String(d.getHours()).padStart(2,'0');
  const m=String(d.getMinutes()).padStart(2,'0');
  return `${mm}/${dd} ${h}:${m}`;
}

function save(){
  state.updatedAt = Date.now();
  localStorage.setItem(LS_KEY, JSON.stringify(state));
  tsEl.textContent = fmtTime(state.updatedAt);
  stampCountEl.textContent = `${state.stamps}ã“`;
}

function load(){
  try{
    const raw = localStorage.getItem(LS_KEY);
    if(raw){
      const obj = JSON.parse(raw);
      if(Array.isArray(obj.items)) state.items = obj.items;
      if(obj.updatedAt) state.updatedAt = obj.updatedAt;
      if(Number.isInteger(obj.stamps)) state.stamps = obj.stamps;
      if(typeof obj.lastStampDate === 'string') state.lastStampDate = obj.lastStampDate;
    }
  }catch(e){}
}

function updateProgress(){
  const total = state.items.length;
  const done = state.items.filter(i=>i.checked).length;
  totalEl.textContent = total;
  countEl.textContent = done;
  const pct = total ? Math.round(done/total*100) : 0;
  barFill.style.width = pct+'%';
  // å¿œæ´ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
  const msg = pct===0 ? 'ãŒã‚“ã°ã‚Œï¼' :
              pct<50 ? 'ã„ã„ã¡ã‚‡ã†ã—ï¼' :
              pct<100 ? 'ã‚ã¨ã™ã“ã—ï¼' :
              'ã‹ã‚“ã›ã„ï¼';
  cheerEl.textContent = msg;
  // å…¨éƒ¨ã§ããŸ â†’ 1æ—¥1å›ã‚¹ã‚¿ãƒ³ãƒ—
  if(total>0 && done===total){
    if(state.lastStampDate !== todayStr){
      state.stamps += 1;
      state.lastStampDate = todayStr;
      save();
      celebrate();
    }
  }
}

function celebrate(){
  // ãƒ¢ãƒ¼ãƒ€ãƒ«
  modal.style.display = 'grid';
  // ç´™ãµã¶ãï¼ˆçµµæ–‡å­—ï¼‰
  cele.innerHTML = '';
  const picks = ['ğŸ‰','âœ¨','ğŸŠ','ğŸŒŸ','ğŸ’«','ğŸ¥³','ğŸŸ¡','ğŸ”µ','ğŸŸ£'];
  const N = 80;
  for(let i=0;i<N;i++){
    const s = document.createElement('span');
    s.textContent = picks[Math.floor(Math.random()*picks.length)];
    s.style.position='fixed';
    s.style.left = Math.random()*100+'vw';
    s.style.top = '-10vh';
    s.style.fontSize = (Math.random()*18+14)+'px';
    s.style.transition = `transform ${(Math.random()*1.5+1.2).toFixed(2)}s ease-in, opacity .3s linear`;
    cele.appendChild(s);
    requestAnimationFrame(()=>{
      s.style.transform = `translate(${(Math.random()*2-1)*30}vw, 120vh) rotate(${(Math.random()*720-360)}deg)`;
    });
    setTimeout(()=> s.style.opacity=0, 1400+Math.random()*500);
    setTimeout(()=> s.remove(), 2200);
  }
}

function render(){
  listEl.innerHTML = '';
  state.items.forEach(item=>{
    const li = document.createElement('li');
    if(item.checked) li.classList.add('checked');

    const icon = document.createElement('div');
    icon.className='icon';
    icon.textContent = pickIcon(item.name);

    const label = document.createElement('label');
    const cb = document.createElement('input');
    cb.type='checkbox'; cb.checked=item.checked;
    cb.addEventListener('change', ()=>{
      item.checked = cb.checked;
      save(); render();
    });

    const name = document.createElement('span');
    name.className='name';
    name.textContent = item.name;

    label.appendChild(cb);
    label.appendChild(name);

    const actions = document.createElement('div');
    actions.className='actions';

    const edit = document.createElement('button');
    edit.className='iconbtn';
    edit.textContent='ç·¨é›†';
    edit.addEventListener('click', ()=>{
      const v = prompt('ãªã¾ãˆã‚’ ãªãŠã™', item.name);
      if(v===null) return;
      const t = v.trim();
      if(!t) return alert('ã‹ã‚‰ã® ãªã¾ãˆã¯ ã ã‚ã ã‚ˆ');
      item.name = t;
      save(); render();
    });

    const del = document.createElement('button');
    del.className='iconbtn';
    del.textContent='å‰Šé™¤';
    del.addEventListener('click', ()=>{
      if(!confirm(`ã€Œ${item.name}ã€ã‚’ ã‘ã™ï¼Ÿ`)) return;
      state.items = state.items.filter(x=>x.id!==item.id);
      save(); render();
    });

    actions.appendChild(edit);
    actions.appendChild(del);

    li.appendChild(icon);
    li.appendChild(label);
    li.appendChild(actions);
    listEl.appendChild(li);
  });

  tsEl.textContent = fmtTime(state.updatedAt);
  updateProgress();
}

/* è¿½åŠ  */
function addItem(name){
  const v = (name ?? inputEl.value).trim();
  if(!v) return;
  state.items.push({id: uid(), name: v, checked:false});
  inputEl.value = '';
  save(); render();
}

/* ã‚¤ãƒ™ãƒ³ãƒˆ */
$('#addBtn').addEventListener('click', ()=> addItem());
inputEl.addEventListener('keydown', (e)=>{ if(e.key==='Enter') addItem(); });

$('#uncheckAllBtn').addEventListener('click', ()=>{
  state.items.forEach(i=> i.checked=false);
  save(); render();
});
$('#clearCheckedBtn').addEventListener('click', ()=>{
  if(!state.items.some(i=>i.checked)) return alert('âœ…ã¯ ã¤ã„ã¦ã„ãªã„ã‚ˆ');
  if(!confirm('âœ…ãŒ ã¤ã„ãŸ ã“ã†ã‚‚ãã‚’ ã‘ã™ï¼Ÿ')) return;
  state.items = state.items.filter(i=>!i.checked);
  save(); render();
});

$('#okBtn').addEventListener('click', ()=> modal.style.display='none');
modal.addEventListener('click', (e)=>{ if(e.target===modal) modal.style.display='none'; });

// ãƒãƒƒãƒ—ã§è¿½åŠ 
document.querySelectorAll('.chip').forEach(c=>{
  c.addEventListener('click', ()=>{
    addItem(c.dataset.add);
    c.classList.add('pop');
    setTimeout(()=> c.classList.remove('pop'), 220);
  });
});

/* èµ·å‹• */
load(); render();
stampCountEl.textContent = `${state.stamps}ã“`;
tsEl.textContent = fmtTime(state.updatedAt);
</script>
</body>
</html>
